<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel of Fortune</title>
<style>
html,body{margin:0;height:100%;overflow-x:hidden;overflow-y:auto;}
body{
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  background:radial-gradient(circle at center,#001d3d,#000);
  font-family:Helvetica,Arial,sans-serif;
  color:#fff;
}
#title{
  position:absolute;
  top:10px;
  text-align:center;
  color:#ffd700;
  text-shadow:0 0 10px #ffd700;
  font-size:2rem;
}
#chart{position:relative;}
#chart:before{
  content:"";
  position:absolute;
  top:50%;left:50%;
  width:120%;height:120%;
  transform:translate(-50%,-50%);
  background:radial-gradient(circle,rgba(255,255,255,0.2),rgba(255,255,255,0) 70%);
  z-index:-1;
}
#chart svg{
  width:100vmin;
  height:100vmin;
  max-width:500px;
  max-height:500px;
  filter:drop-shadow(0 0 15px gold);
}
#question{
  margin-top:20px;
  text-align:center;
}
#question h1{font-size:1.3rem;font-weight:bold;margin:0;max-width:90vw;overflow-wrap:anywhere;}
#spinBtn{
  margin-top:20px;
  padding:1rem 2rem;
  font-size:1.2rem;
  background:linear-gradient(#ffd700,#b8860b);
  color:#000;
  border:none;
  border-radius:8px;
  cursor:pointer;
  animation:pulse 2s infinite;
}
#spinBtn:disabled{opacity:.5;cursor:not-allowed;animation:none;}
#spinBtn:hover{box-shadow:0 0 10px #ffd700;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
#mute{
  position:absolute;
  top:10px;
  right:10px;
  background:transparent;
  border:none;
  font-size:1.5rem;
  color:#fff;
  cursor:pointer;
}
#overlay{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,0.8);
  color:#ffd700;
  padding:1rem 2rem;
  border:2px solid #ffd700;
  border-radius:10px;
  display:none;
  text-align:center;
  font-size:2rem;
}
@media(max-width:400px){
  #title{font-size:1.2rem;}
  #question h1{font-size:1rem;}
  #spinBtn{padding:0.8rem 1.2rem;font-size:1rem;}
}
</style>
</head>
<body>
<h1 id="title">WILLKOMMEN ZUM GL√úCKSRAD</h1>
<button id="mute">üîä</button>
<div id="chart"></div>
<div id="question" aria-live="polite"><h1></h1></div>
<div id="overlay"></div>
<button id="spinBtn" aria-label="Rad drehen">DREHEN</button>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
var padding={top:20,right:20,bottom:20,left:20},
    w=500-padding.left-padding.right,
    h=500-padding.top-padding.bottom,
    r=Math.min(w,h)/2,
    rotation=0,
    oldrotation=0,
    picked=100000,
    oldpick=[],
    color=d3.scale.category20();
const TROST_INDEX=7;
var data = [
 {label:"üõçÔ∏è 100‚Ç¨ Ikea", value:1, question:"Knapp daneben! Dein Wohnzimmer muss noch warten üòÖ"},
 {label:"üé¢ Europapark", value:1, question:"Leider kein Adrenalinkick ‚Äì aber vielleicht beim n√§chsten Dreh üé¢"},
 {label:"üé∞ Beinahe Jackpot", value:1, question:"Die Menge tobt ‚Äì doch das richtige Feld war nur einen Hauch entfernt..."},
 {label:"üîÑ Extra Dreh", value:1, question:"Der Moderator g√∂nnt dir eine Extra-Chance üîÑ"},
 {label:"üôà Niete", value:1, question:"Immerhin kein Totalverlust, dreh nochmal!"},
 {label:"üí¶ Therme Erding", value:1, question:"Hei√üe Quellen bleiben heute kalt üí¶"},
 {label:"‚≠ê Staubsaugerbot", value:1, question:"Oh nein! Knapp am ultimativen Gewinn vorbeigeschrammt ü§ñ"},
 {label:"üéÅ Eis-Date", value:1, question:"Happy Birthday Sammy! Dein echtes Geschenk ist ein Eis-Date üç¶üéâ"}
];


var svg=d3.select("#chart")
          .append("svg")
          .attr("width",w+padding.left+padding.right)
          .attr("height",h+padding.top+padding.bottom)
          .attr("viewBox","0 0 "+(w+padding.left+padding.right)+" "+(h+padding.top+padding.bottom))
          .attr("preserveAspectRatio","xMidYMid meet");

var container=svg.append("g")
                 .attr("class","chartholder")
                 .attr("transform","translate("+(w/2+padding.left)+","+(h/2+padding.top)+")");

var vis=container.append("g");

var pie=d3.layout.pie().sort(null).value(function(d){return 1;});
var arc=d3.svg.arc().outerRadius(r);
var arcs=vis.selectAll("g.slice")
            .data(pie(data))
            .enter()
            .append("g")
            .attr("class","slice");

arcs.append("path")
    .attr("fill",function(d,i){return color(i);})
    .attr("d",arc);

arcs.append("text")
    .attr("transform",function(d,i){
       d.innerRadius=0; d.outerRadius=r;
       d.angle=(d.startAngle+d.endAngle)/2;
       var radius=r*0.6;
       var angle=d.angle*180/Math.PI-90;
       return "rotate("+angle+")translate("+radius+")rotate("+(-angle)+")";
    })
    .attr("text-anchor","middle")
    .style("font-size","16px")
    .style("dominant-baseline","middle")
    .text(function(d,i){return data[i].label;});

svg.append("g")
   .attr("transform","translate("+(w+padding.left)+","+(h/2+padding.top)+")")
   .append("path")
   .attr("d","M-"+(r*.15)+",0L0,"+(r*.05)+"L0,-"+(r*.05)+"Z")
   .style({fill:"gold"});

var spinBtn=document.getElementById("spinBtn");
var overlay=document.getElementById("overlay");
var muteBtn=document.getElementById("mute");
var muted=false;

var audioCtx=window.AudioContext?new AudioContext():null;
function playTone(freq,duration){
    if(!audioCtx||muted)return;
    var osc=audioCtx.createOscillator();
    var gain=audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.value=freq;
    osc.start();
    gain.gain.setValueAtTime(1,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);
    osc.stop(audioCtx.currentTime+duration);
}
function applause(){if(!audioCtx||muted)return; for(var i=0;i<5;i++){setTimeout(function(){playTone(200+Math.random()*200,0.3);},i*150);}}
function tick(){playTone(800,0.05);}
function ooh(){playTone(300,0.5);}

muteBtn.addEventListener("click",function(){
   muted=!muted;
   muteBtn.textContent=muted?"üîá":"üîä";
});

spinBtn.addEventListener("click",spin);

var tickTimer;
var picked1;

function spin(){
   spinBtn.disabled=true;
   var ps=360/data.length;

   do{
     picked1=Math.floor(Math.random()*data.length);
   }while(picked1===TROST_INDEX || picked1===6);

   var turns1=5+Math.floor(Math.random()*3);
   rotation=turns1*360 - picked1*ps;
   rotation += 90 - ps/2;

   vis.transition()
       .duration(5000)
       .attrTween("transform",rotTween)
       .each("start",function(){tickTimer=setInterval(tick,60);})
       .each("end",function(){
           clearInterval(tickTimer);
           oldrotation=rotation;
           d3.select("#question h1").text(data[picked1].question);
           if(picked1===3 || picked1===4){
               overlay.style.display="block";
               overlay.textContent=Math.random()>0.5?"Zweite Chance!":"Super-Spin!";
               ooh();
               setTimeout(function(){overlay.style.display="none"; phase2();},800+Math.random()*700);
           }else{
               setTimeout(phase2,800+Math.random()*700);
           }
       });
}

function phase2(){
   overlay.style.display="none";
   var ps=360/data.length;
   var picked2=TROST_INDEX;
   var turns2=4+Math.floor(Math.random()*3);
   rotation=oldrotation + turns2*360 + (picked1 - picked2)*ps;

   vis.transition()
       .duration(6000)
       .attrTween("transform",rotTween)
       .each("start",function(){tickTimer=setInterval(tick,60);})
       .each("end",function(){
           clearInterval(tickTimer);
           oldrotation=rotation;
           d3.select("#question h1").text(data[picked2].question);
           try{confetti({particleCount:150,spread:70,origin:{y:0.6}});}catch(e){}
           applause();
           spinBtn.remove();
       });
}

function rotTween(){
  var i=d3.interpolate(oldrotation,rotation);
  return function(t){return "rotate("+i(t)+")";};
}
</script>
</body>
</html>
