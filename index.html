<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel of Fortune</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;}
body{
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  background:radial-gradient(circle at center,#001d3d,#000);
  font-family:Helvetica,Arial,sans-serif;
  color:#fff;
}
#title{
  position:absolute;
  top:10px;
  text-align:center;
  color:#ffd700;
  text-shadow:0 0 10px #ffd700;
  font-size:2rem;
}
#chart{position:relative;}
#chart:before{
  content:"";
  position:absolute;
  top:50%;left:50%;
  width:120%;height:120%;
  transform:translate(-50%,-50%);
  background:radial-gradient(circle,rgba(255,255,255,0.2),rgba(255,255,255,0) 70%);
  z-index:-1;
}
#chart svg{
  width:100vmin;
  height:100vmin;
  max-width:500px;
  max-height:500px;
  filter:drop-shadow(0 0 15px gold);
}
#question{
  margin-top:20px;
  text-align:center;
}
#question h1{font-size:1.3rem;font-weight:bold;margin:0;}
#spinBtn{
  margin-top:20px;
  padding:1rem 2rem;
  font-size:1.2rem;
  background:linear-gradient(#ffd700,#b8860b);
  color:#000;
  border:none;
  border-radius:8px;
  cursor:pointer;
  animation:pulse 2s infinite;
}
#spinBtn:disabled{opacity:.5;cursor:not-allowed;animation:none;}
#spinBtn:hover{box-shadow:0 0 10px #ffd700;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
#mute{
  position:absolute;
  top:10px;
  right:10px;
  background:transparent;
  border:none;
  font-size:1.5rem;
  color:#fff;
  cursor:pointer;
}
#overlay{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,0.8);
  color:#ffd700;
  padding:1rem 2rem;
  border:2px solid #ffd700;
  border-radius:10px;
  display:none;
  text-align:center;
  font-size:2rem;
}
#gift{
  display:none;
  margin-top:15px;
  padding:1rem;
  font-size:1rem;
  background:linear-gradient(#ffd700,#b8860b);
  border:none;
  border-radius:8px;
  cursor:pointer;
}
@media(max-width:400px){
  #title{font-size:1.2rem;}
  #question h1{font-size:1rem;}
  #spinBtn{padding:0.8rem 1.2rem;font-size:1rem;}
}
</style>
</head>
<body>
<h1 id="title">WILLKOMMEN ZUM GL√úCKSRAD</h1>
<button id="mute">üîä</button>
<div id="chart"></div>
<div id="question" aria-live="polite"><h1></h1></div>
<div id="overlay"></div>
<button id="spinBtn" aria-label="Rad drehen">DREHEN</button>
<button id="gift">Geschenk √∂ffnen</button>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
var padding={top:20,right:20,bottom:20,left:20},
    w=500-padding.left-padding.right,
    h=500-padding.top-padding.bottom,
    r=Math.min(w,h)/2,
    rotation=0,
    oldrotation=0,
    picked=100000,
    oldpick=[],
    color=d3.scale.category20();
const TROST_INDEX=7;
var data=[
 {label:"Beinahe Jackpot!",value:1,question:"Uff! Das war richtig knapp‚Ä¶ versuch‚Äôs nochmal!"},
 {label:"Niete ‚Äì weiter geht‚Äôs",value:1,question:"Keine Sorge, in der n√§chsten Runde wird‚Äôs was‚Ä¶ vielleicht üòá"},
 {label:"Fast der Hauptgewinn",value:1,question:"Die Menge tobt! Doch das Feld z√§hlt leider nicht‚Ä¶"},
 {label:"Nochmal drehen?",value:1,question:"Klar! B√ºhne frei f√ºr den n√§chsten Spin."},
 {label:"Gl√ºck im Ungl√ºck",value:1,question:"Nicht gewonnen, aber‚Ä¶ da geht noch was!"},
 {label:"Bankrott (nur Spa√ü)",value:1,question:"Show-Gag! Dein Konto bleibt unber√ºhrt."},
 {label:"Hauptpreis ‚≠ê",value:1,question:"Oh nein! Knapp verfehlt‚Ä¶ das Feld war nur Deko f√ºrs TV-Feeling."},
 {label:"üéÅ Trostpreis ‚Äì dein Geschenk",value:1,question:"Happy Birthday! Hier ist dein Geschenk üéâ"}
];

var svg=d3.select("#chart")
          .append("svg")
          .attr("width",w+padding.left+padding.right)
          .attr("height",h+padding.top+padding.bottom)
          .attr("viewBox","0 0 "+(w+padding.left+padding.right)+" "+(h+padding.top+padding.bottom))
          .attr("preserveAspectRatio","xMidYMid meet");

var container=svg.append("g")
                 .attr("class","chartholder")
                 .attr("transform","translate("+(w/2+padding.left)+","+(h/2+padding.top)+")");

var vis=container.append("g");

var pie=d3.layout.pie().sort(null).value(function(d){return 1;});
var arc=d3.svg.arc().outerRadius(r);
var arcs=vis.selectAll("g.slice")
            .data(pie(data))
            .enter()
            .append("g")
            .attr("class","slice");

arcs.append("path")
    .attr("fill",function(d,i){return color(i);})
    .attr("d",arc);

arcs.append("text")
    .attr("transform",function(d){
       d.innerRadius=0; d.outerRadius=r;
       d.angle=(d.startAngle+d.endAngle)/2;
       return "rotate("+(d.angle*180/Math.PI-90)+")translate("+(d.outerRadius-10)+")";
    })
    .attr("text-anchor","end")
    .text(function(d,i){return data[i].label;});

svg.append("g")
   .attr("transform","translate("+(w+padding.left)+","+(h/2+padding.top)+")")
   .append("path")
   .attr("d","M-"+(r*.15)+",0L0,"+(r*.05)+"L0,-"+(r*.05)+"Z")
   .style({fill:"gold"});

var spinBtn=document.getElementById("spinBtn");
var overlay=document.getElementById("overlay");
var giftBtn=document.getElementById("gift");
var muteBtn=document.getElementById("mute");
var muted=false;

var audioCtx=window.AudioContext?new AudioContext():null;
function playTone(freq,duration){
    if(!audioCtx||muted)return;
    var osc=audioCtx.createOscillator();
    var gain=audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.value=freq;
    osc.start();
    gain.gain.setValueAtTime(1,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);
    osc.stop(audioCtx.currentTime+duration);
}
var drum;
function startDrum(){
    if(!audioCtx||muted)return;
    drum=audioCtx.createOscillator();
    var g=audioCtx.createGain();
    drum.type="square"; drum.frequency.value=100;
    drum.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.3,audioCtx.currentTime);
    drum.start();
}
function stopDrum(){if(drum){drum.stop(); drum=null;}}
function applause(){if(!audioCtx||muted)return; for(var i=0;i<5;i++){setTimeout(function(){playTone(200+Math.random()*200,0.3);},i*150);}}
function tick(){playTone(800,0.05);}
function ooh(){playTone(300,0.5);}

muteBtn.addEventListener("click",function(){
   muted=!muted;
   muteBtn.textContent=muted?"üîá":"üîä";
});

spinBtn.addEventListener("click",spin);

var tickTimer;
var picked1;

function spin(){
   spinBtn.disabled=true;
   var ps=360/data.length;

   do{
     picked1=Math.floor(Math.random()*data.length);
   }while(picked1===TROST_INDEX || picked1===6);

   var turns1=3+Math.floor(Math.random()*2);
   rotation=turns1*360 - picked1*ps;
   rotation += 90 - ps/2;

   vis.transition()
       .duration(4000)
       .attrTween("transform",rotTween)
       .each("start",function(){tickTimer=setInterval(tick,60);})
       .each("end",function(){
           clearInterval(tickTimer);
           oldrotation=rotation;
           d3.select("#question h1").text(data[picked1].question);
           overlay.style.display="block";
           overlay.textContent=Math.random()>0.5?"Zweite Chance!":"Super-Spin!";
           ooh();
           setTimeout(phase2,800+Math.random()*700);
       });
}

function phase2(){
   overlay.style.display="none";
   startDrum();
   var ps=360/data.length;
   var picked2=TROST_INDEX;
   var turns2=2+Math.floor(Math.random()*2);
   rotation=oldrotation + turns2*360 + (picked1 - picked2)*ps;

   vis.transition()
       .duration(5000)
       .attrTween("transform",rotTween)
       .each("start",function(){tickTimer=setInterval(tick,60);})
       .each("end",function(){
           clearInterval(tickTimer);
           stopDrum();
           oldrotation=rotation;
           d3.select("#question h1").text(data[picked2].question);
           try{confetti({particleCount:150,spread:70,origin:{y:0.6}});}catch(e){}
           applause();
           giftBtn.style.display="block";
           spinBtn.disabled=false;
       });
}

function rotTween(){
  var i=d3.interpolate(oldrotation,rotation);
  return function(t){return "rotate("+i(t)+")";};
}
</script>
</body>
</html>
